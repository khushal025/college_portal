<!DOCTYPE html>
<html>
<head>
    <title>Teacher Dashboard</title>
    <style>
        body { font-family: Arial; background: #f5f7fa; margin:0; padding:0; }
        header { background: #1a73e8; color: white; padding: 10px 20px; }
        .container { padding: 20px; }
        input, button { padding: 8px; margin: 5px; }
        button { cursor: pointer; background: #1a73e8; color:white; border:none; }
        #student_data pre { background:#e9ecef; padding:10px; border-radius:5px; }
        .upload-btn { margin: 10px 0; }
    </style>
</head>
<body>
<header>
    <h2>Welcome, {{ teacher }}</h2>
</header>

<div class="container">
    <h3>Search Student</h3>
    <input type="text" id="roll_no_search" placeholder="Enter Roll No">
    <button onclick="searchStudent()">Search</button>

    <div id="student_data"></div>

    <hr>
    <h3>Upload Data</h3>

    <button onclick="document.getElementById('upload_attendance').click()" class="upload-btn">Upload Attendance</button>
    <input type="file" id="upload_attendance" style="display:none" onchange="uploadFile('attendance', this.files[0])">

    <button onclick="document.getElementById('upload_results').click()" class="upload-btn">Upload Results</button>
    <input type="file" id="upload_results" style="display:none" onchange="uploadFile('results', this.files[0])">

    <button onclick="document.getElementById('upload_students').click()" class="upload-btn">+ Add Students</button>
    <input type="file" id="upload_students" style="display:none" onchange="uploadFile('students', this.files[0])">
</div>

<script>
function searchStudent() {
    let roll_no = document.getElementById('roll_no_search').value;
    fetch(`/api/get_student_data/${roll_no}`)
    .then(res => res.json())
    .then(data => {
        if(data.error){ alert(data.error); return; }
        let student = data.student;
        let attendance = data.attendance;
        let results = data.results;

        let html = `<h4>${student[1]} (Roll: ${student[0]})</h4>
                    <p>Father: ${student[2]}</p>
                    <p>Course: ${student[3]}, Semester: ${student[4]}</p>
                    <p>Email: ${student[5]}</p>
                    <h4>Attendance</h4><pre>${JSON.stringify(attendance,null,2)}</pre>
                    <h4>Results</h4><pre>${JSON.stringify(results,null,2)}</pre>`;

        document.getElementById('student_data').innerHTML = html;
    });
}

function uploadFile(type, file) {
    let fd = new FormData();
    fd.append('file', file);
    fetch(`/upload_${type}`, { method:'POST', body: fd })
        .then(res => res.json())
        .then(data => alert(data.message))
        .catch(err => alert('Upload failed'));
}
</script>
</body>
</html>
